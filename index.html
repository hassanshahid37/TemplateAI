<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Templify â€“ Dark Premium AI Template Generator</title>

  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --primary:#0b5fff;
      --muted:#aab0bd;

      /* DARK (transparent) */
      --bg:#050712;
      --panel:rgba(15,18,32,.55);
      --panel2:rgba(15,18,32,.35);
      --stroke:rgba(255,255,255,.10);
      --text:#f6f7fb;

      --shadow:0 18px 50px rgba(0,0,0,.45);
      --radius:18px;
    }
    [data-theme="light"]{
      --bg:#f5f7ff;
      --panel:rgba(255,255,255,.72);
      --panel2:rgba(255,255,255,.55);
      --stroke:rgba(10,20,60,.12);
      --text:#0b1020;
      --shadow:0 18px 40px rgba(10,20,60,.18);
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:Poppins,system-ui,-apple-system,Segoe UI,Roboto,Arial;
      color:var(--text);
      background:
        radial-gradient(1200px 700px at 15% 10%, rgba(11,95,255,.22), transparent 60%),
        radial-gradient(900px 600px at 85% 20%, rgba(136,71,255,.18), transparent 55%),
        radial-gradient(900px 600px at 35% 95%, rgba(0,225,255,.10), transparent 55%),
        var(--bg);
      overflow-x:hidden;
    }

    .wrap{max-width:1200px;margin:0 auto;padding:26px 18px 60px}
    header{
      display:flex;align-items:center;justify-content:space-between;gap:12px;
      padding:14px 16px;border:1px solid var(--stroke);
      background:var(--panel);
      backdrop-filter: blur(16px);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      position:sticky;top:14px;z-index:20;
    }
    .brand{display:flex;align-items:center;gap:12px}
    .logo{
      width:38px;height:38px;border-radius:12px;
      background:linear-gradient(135deg, rgba(11,95,255,.95), rgba(136,71,255,.88));
      box-shadow:0 10px 26px rgba(11,95,255,.28);
      border:1px solid rgba(255,255,255,.18);
    }
    .brand h1{font-size:15px;margin:0;font-weight:700;letter-spacing:.2px}
    .brand p{margin:0;color:var(--muted);font-size:12px}
    .actions{display:flex;align-items:center;gap:10px;flex-wrap:wrap}
    .btn{
      appearance:none;border:1px solid var(--stroke);
      background:var(--panel2);
      color:var(--text);
      padding:10px 12px;border-radius:14px;
      font-weight:600;font-size:12.5px;
      cursor:pointer;transition:.15s ease;
      backdrop-filter: blur(16px);
      display:inline-flex;align-items:center;gap:8px;
    }
    .btn:hover{transform:translateY(-1px);border-color:rgba(11,95,255,.35)}
    .btn.primary{
      background:linear-gradient(135deg, rgba(11,95,255,.95), rgba(136,71,255,.85));
      border-color:rgba(255,255,255,.14);
      box-shadow:0 12px 30px rgba(11,95,255,.22);
    }
    .btn:active{transform:translateY(0px)}
    .tag{
      padding:6px 10px;border:1px solid var(--stroke);
      background:var(--panel2);
      border-radius:999px;font-size:12px;color:var(--muted)
    }

    main{margin-top:18px;display:grid;grid-template-columns:1.1fr .9fr;gap:18px}
    .card{
      border:1px solid var(--stroke);
      background:var(--panel);
      backdrop-filter: blur(16px);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      overflow:hidden;
    }
    .hero{padding:26px}
    .hero h2{margin:0 0 10px;font-size:34px;line-height:1.12}
    .hero p{margin:0 0 16px;color:var(--muted);font-size:14px;line-height:1.55}
    .grid{
      display:grid;grid-template-columns:repeat(3,minmax(0,1fr));
      gap:12px;margin-top:18px
    }
    .tile{
      padding:14px;border:1px solid var(--stroke);
      background:var(--panel2);
      border-radius:16px;
      min-height:92px;
      position:relative;
      overflow:hidden;
    }
    .thumb{
      height:84px;
      border-radius:12px;
      margin-bottom:10px;
      position:relative;
      background:
        radial-gradient(160px 80px at 20% 20%, rgba(11,95,255,.24), transparent 60%),
        radial-gradient(140px 90px at 90% 35%, rgba(136,71,255,.18), transparent 60%),
        linear-gradient(135deg, rgba(255,255,255,.12), rgba(255,255,255,.04));
      border:1px solid rgba(255,255,255,.14);
    }
    [data-theme="light"] .thumb{
      background:
        radial-gradient(160px 80px at 20% 20%, rgba(11,95,255,.14), transparent 60%),
        radial-gradient(140px 90px at 90% 35%, rgba(136,71,255,.10), transparent 60%),
        linear-gradient(135deg, rgba(10,20,60,.06), rgba(10,20,60,.02));
      border:1px solid rgba(10,20,60,.12);
    }
    .mini{
      position:absolute;
      border-radius:10px;
      border:1px solid rgba(255,255,255,.16);
      background:rgba(255,255,255,.10);
    }
    [data-theme="light"] .mini{
      border:1px solid rgba(10,20,60,.12);
      background:rgba(10,20,60,.06);
    }
    .tile b{display:block;font-size:12.5px;margin-bottom:6px}
    .tile span{font-size:12px;color:var(--muted);line-height:1.35}
    .right{padding:18px}
    .right h3{margin:2px 0 10px;font-size:14px}
    .field{margin:10px 0}
    .field label{display:block;font-size:12px;color:var(--muted);margin:0 0 6px}
    .field input,.field select,.field textarea{
      width:100%;padding:11px 12px;border-radius:14px;
      border:1px solid var(--stroke);
      background:rgba(0,0,0,.10);
      color:var(--text);
      outline:none;
    }
    [data-theme="light"] .field input,
    [data-theme="light"] .field select,
    [data-theme="light"] .field textarea{
      background:rgba(255,255,255,.50);
    }
    textarea{min-height:96px;resize:vertical}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    .foot{
      display:flex;align-items:center;justify-content:space-between;gap:10px;
      padding:14px 18px;border-top:1px solid var(--stroke);
      color:var(--muted);font-size:12px
    }

    @media (max-width: 980px){
      main{grid-template-columns:1fr}
      .hero h2{font-size:28px}
      .grid{grid-template-columns:repeat(2,minmax(0,1fr))}
    }
    @media (max-width: 520px){
      header{position:relative;top:auto}
      .grid{grid-template-columns:1fr}
      .row{grid-template-columns:1fr}
    }
  
    /* FIX: dropdown options visibility + borders */
    
    select{
      border:1px solid rgba(10,20,60,.45);
      background:#ffffff;
      color:#0b1020;
    }
    select option{
      color:#0b1020;
      background:#ffffff;
    }
    [data-theme="dark"] select{
      border:1px solid rgba(255,255,255,.25);
      background:#0b1020;
      color:#ffffff;
    }
    [data-theme="dark"] select option{
      color:#ffffff;
      background:#0b1020;
    }
    
    [data-theme="dark"] select option{color:#ffffff;background:#0b1020;}
    
/* === Nexora Canva-style previews === */
.tile .preview-canvas{
  position: relative;
  height: 120px;
  border-radius: 14px;
  overflow: hidden;
  background: rgba(255,255,255,.06);
  border: 1px solid var(--stroke);
  margin-bottom: 10px;
}
.tile .preview-canvas .pv-text{
  position:absolute;
  left:12px;
  right:12px;
  font-weight:700;
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
}

</style>
    
</head>

<body data-theme="dark">
  <div class="wrap">
    <header>
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <div>
          <h1>Templify</h1>
          <p>Dark Premium AI Template Generator + Ultimate Editor v1</p>
        </div>
      </div>

      <div class="actions">
        <span class="tag">No auth â€¢ No subscriptions â€¢ Netlify-ready</span>
        <button class="btn" id="themeBtn" type="button">ðŸŒ— Toggle theme</button>
        <button class="btn primary" id="openEditor" type="button">Open Editor</button>
        <button class="btn" id="btnTemplates" type="button">ðŸ“š Library</button>
        <button class="btn" id="btnAnimate" type="button">ðŸŽ¬ Animate</button>

      </div>
    </header>

    <main>
      <section class="card hero">
        <h2>Create hundreds of premium templates in minutes.</h2>
        <p>
          Generate designs fast, then fineâ€‘tune in the editor with a Canvaâ€‘style workflow:
          layers, properties, snap grid, multiâ€‘select, duplicate, undo/redo, and autosave.
        </p>

        <div class="actions" style="margin-top:14px">
          <button class="btn primary" id="generateBtn" type="button">âš¡ Generate Templates</button>
        <button class="btn" id="newLayoutBtn" type="button">ðŸ§© New Layout</button>
        <button class="btn" id="newStyleBtn" type="button">ðŸŽ¨ New Style</button>

          <button class="btn" id="exportBtn" type="button">â¬‡ Export List (JSON)</button>
        </div>

        <div class="grid" id="previewGrid" aria-live="polite" style="margin-top:18px"></div>
      </section>

      <aside class="card right">
        <h3>Generation settings</h3>

        <div class="field">
          <label>Category</label>
          <select id="cat">
            <option>Instagram Post</option>
            <option>YouTube Thumbnail</option>
            <option>Flyer</option>
            <option>Business Card</option>
            <option>Logo</option>
            <option>Presentation Slide</option>
            <option>Resume</option>
            <option>Poster</option>
            <option>Story</option>
          </select>
        </div>

        <div class="row">
          <div class="field">
            <label>Count (max 200)</label>
            <input id="count" type="number" min="1" max="200" value="24" />
          </div>
          <div class="field">
            <label>Style</label>
            <select id="style">
              <option>Dark Premium</option>
              <option>Light Minimal</option>
              <option>Neon</option>
              <option>Glassmorphism</option>
              <option>Corporate</option>
            </select>
          </div>
        </div>

        <div class="field">
          <label>Prompt</label>
          <textarea id="prompt" placeholder="e.g., Premium real-estate carousel for luxury apartments, bold typography, modern shapes..."></textarea>
        </div>

        <div class="field">
          <label>Notes</label>
          <input id="notes" placeholder="(optional) brand name, colors, etc." />
        </div>

        <div class="foot">
          <span>Tip: Click any preview to open it in the Editor.</span>
          <span id="status">Ready</span>
        </div>
      </aside>
    </main>
  </div>


<script>
/* Nexora / Templify â€” SAFE generator wiring + Canva-style previews
   - Preserves UI/CSS
   - No globals required
   - No risky regex
*/

const $ = (s)=>document.querySelector(s);
const el = (id)=>document.getElementById(id);

const themeBtn = el("themeBtn");
const openEditorBtn = el("openEditor");
const btnTemplates = el("btnTemplates");
const btnAnimate = el("btnAnimate");

const generateBtn = el("generateBtn");
const newLayoutBtn = el("newLayoutBtn");
const newStyleBtn = el("newStyleBtn");
const exportBtn = el("exportBtn");

const grid = el("previewGrid");
const catSel = el("cat");
const countInp = el("count");
const styleSel = el("style");
const promptInp = el("prompt");
const notesInp = el("notes");
const statusEl = el("status");

let __lastTemplates = [];

function setStatus(msg){
  if(statusEl) statusEl.textContent = msg || "";
}

function getTheme(){
  return document.body.getAttribute("data-theme") || "dark";
}
function setTheme(t){
  document.body.setAttribute("data-theme", t);
  localStorage.setItem("templify_theme", t);
  themeBtn && (themeBtn.textContent = t === "dark" ? "ðŸŒ™ Toggle theme" : "â˜€ï¸ Toggle theme");
}
function toggleTheme(){
  setTheme(getTheme()==="dark" ? "light" : "dark");
}

function safeInt(v, d){
  const n = parseInt(v, 10);
  return Number.isFinite(n) ? n : d;
}
function clamp(n,a,b){ return Math.max(a, Math.min(b,n)); }

/* -------- Canva-like thumbnail rendering (hero-first) -------- */
function renderPreview(thumb, t){
  if(!thumb) return;
  thumb.innerHTML = "";
  thumb.style.background = t.bg || t.canvas?.background || "rgba(255,255,255,.06)";

  // find hero heading, support text, and CTA
  const els = Array.isArray(t.elements) ? t.elements : [];
  const heading = els.find(e => e.type === "heading") || els.find(e => (e.type==="text" && (e.fontSize||0) >= 42)) || null;
  const support = els.find(e => e.type === "text" && e !== heading) || null;
  const cta = els.find(e => e.type === "button") || null;

  // subtle overlay for contrast
  const ov = document.createElement("div");
  ov.style.position="absolute";
  ov.style.inset="0";
  ov.style.background="linear-gradient(180deg,rgba(0,0,0,.10),rgba(0,0,0,.48))";
  ov.style.pointerEvents="none";
  thumb.appendChild(ov);

  if(heading){
    const h = document.createElement("div");
    h.className = "pv-text";
    h.textContent = (heading.title || heading.text || "").toString();
    h.style.top = "12px";
    h.style.left = "12px";
    h.style.right = "12px";
    h.style.fontSize = "18px";
    h.style.fontWeight = "800";
    h.style.lineHeight = "1.1";
    h.style.textShadow = "0 10px 26px rgba(0,0,0,.55)";
    h.style.maxHeight = "44px";
    h.style.overflow = "hidden";
    h.style.whiteSpace = "normal";
    h.style.display = "-webkit-box";
    h.style.webkitLineClamp = "2";
    h.style.webkitBoxOrient = "vertical";
    h.style.color = heading.color || "#fff";
    thumb.appendChild(h);
  }

  if(support){
    const s = document.createElement("div");
    s.className = "pv-text";
    s.textContent = (support.title || support.text || "").toString();
    s.style.top = "62px";
    s.style.left = "12px";
    s.style.right = "12px";
    s.style.fontSize = "12px";
    s.style.opacity = ".92";
    s.style.maxHeight = "28px";
    s.style.overflow = "hidden";
    s.style.whiteSpace = "normal";
    s.style.display = "-webkit-box";
    s.style.webkitLineClamp = "2";
    s.style.webkitBoxOrient = "vertical";
    s.style.color = support.color || "rgba(255,255,255,.86)";
    thumb.appendChild(s);
  }

  if(cta){
    const b = document.createElement("div");
    b.style.position="absolute";
    b.style.left="12px";
    b.style.bottom="12px";
    b.style.padding="8px 12px";
    b.style.borderRadius="999px";
    b.style.fontSize="12px";
    b.style.fontWeight="700";
    b.style.background = cta.fill || cta.background || "rgba(255,255,255,.14)";
    b.style.border = "1px solid rgba(255,255,255,.18)";
    b.style.backdropFilter = "blur(8px)";
    b.style.boxShadow = "0 10px 26px rgba(0,0,0,.35)";
    b.style.color = cta.color || "#fff";
    b.textContent = (cta.title || cta.text || "Open").toString();
    thumb.appendChild(b);
  }
}

/* -------- Grid render -------- */
function renderGrid(list, { category, style }){
  __lastTemplates = Array.isArray(list) ? list : [];
  grid.innerHTML = "";

  for(let i=0;i<__lastTemplates.length;i++){
    const t = __lastTemplates[i];
    const tile = document.createElement("div");
    tile.className = "tile";
    tile.tabIndex = 0;

    // structure (keeps existing CSS expectations)
    tile.innerHTML = `
      <div class="thumb" aria-hidden="true"></div>
      <b>${escapeHtml(t.title || `${category} #${i+1}`)}</b>
      <span>${escapeHtml((t.description || `${style} â€¢ Click to edit`))}</span>
    `;

    const thumb = tile.querySelector(".thumb");
    thumb.style.position = "relative"; // required for overlay + CTA
    renderPreview(thumb, t);

    tile.addEventListener("click", ()=>openEditorWith(t, { category, style }));
    tile.addEventListener("keydown",(e)=>{ if(e.key==="Enter") openEditorWith(t, { category, style }); });

    grid.appendChild(tile);
  }
}

function openEditorWith(tpl, { category, style }){
  const payload = {
    meta: { cat: category, style },
    canvas: tpl.canvas || { w: 980, h: 620 },
    elements: tpl.elements || []
  };
  try{ localStorage.setItem("templify_draft", JSON.stringify(payload)); }catch(e){}
  window.location.href = "editor.html";
}

/* -------- Safe HTML escape for titles/descriptions -------- */
function escapeHtml(s){
  return String(s ?? "")
    .replaceAll("&","&amp;")
    .replaceAll("<","&lt;")
    .replaceAll(">","&gt;")
    .replaceAll('"',"&quot;")
    .replaceAll("'","&#39;");
}

/* -------- Seed (instant) templates before Generate -------- */
function makeSeedTemplates({ count, category, style }){
  const seeds = [];
  const seedBg = [
    "linear-gradient(135deg,#0b5fff,#7b5cff)",
    "linear-gradient(135deg,#07130f,#00c389)",
    "linear-gradient(135deg,#1f1409,#ffcc66)",
    "linear-gradient(135deg,#0b1020,#00d1ff)",
  ];
  for(let i=0;i<count;i++){
    const bg = seedBg[i % seedBg.length];
    seeds.push({
      id: `seed_${Date.now()}_${i}`,
      title: `${category} #${i+1}`,
      description: `${style} â€¢ Ready â€¢ Click to edit`,
      category,
      style,
      bg,
      canvas: { w: 980, h: 620 },
      elements: [
        { id:`h_${i}`, type:"heading", x:80, y:90, w:820, h:90, title:"New Collection", fontSize:64, fontWeight:800, color:"#fff" },
        { id:`t_${i}`, type:"text", x:80, y:180, w:620, h:60, title:"Premium layout with bold hierarchy and clean spacing.", fontSize:20, fontWeight:500, color:"rgba(255,255,255,.86)" },
        { id:`b_${i}`, type:"button", x:80, y:270, w:220, h:54, title:"Get Started", fill:"rgba(255,255,255,.14)", color:"#fff", radius:999 }
      ]
    });
  }
  return seeds;
}

/* -------- API Generate -------- */
async function generateFromApi(){
  const category = catSel?.value || "Instagram Post";
  const style = styleSel?.value || "Dark Premium";
  const count = clamp(safeInt(countInp?.value, 24), 1, 200);
  const prompt = (promptInp?.value || "").trim();
  const notes = (notesInp?.value || "").trim();

  setStatus("Generatingâ€¦");

  try{
    const res = await fetch("/api/generate", {
      method:"POST",
      headers: { "Content-Type":"application/json" },
      body: JSON.stringify({ category, style, count, prompt, notes })
    });
    const data = await res.json().catch(()=>null);

    const list = data?.templates;
    if(Array.isArray(list) && list.length){
      renderGrid(list, { category, style });
      setStatus(`Generated ${list.length} templates`);
      try{ localStorage.setItem("templify_last_templates", JSON.stringify(list)); }catch(e){}
      return;
    }

    // fallback: keep seeds
    setStatus("No templates returned â€” showing defaults");
    renderGrid(makeSeedTemplates({ count, category, style }), { category, style });

  }catch(err){
    console.warn(err);
    setStatus("Generate failed â€” showing defaults");
    renderGrid(makeSeedTemplates({ count, category, style }), { category, style });
  }
}

/* -------- Buttons wiring -------- */
themeBtn && themeBtn.addEventListener("click", toggleTheme);
openEditorBtn && openEditorBtn.addEventListener("click", ()=>{ window.location.href="editor.html"; });

generateBtn && generateBtn.addEventListener("click", generateFromApi);

newLayoutBtn && newLayoutBtn.addEventListener("click", ()=>{
  // lightweight: shuffle tiles for instant "new layout" feel without breaking schema
  __lastTemplates = (__lastTemplates||[]).slice().sort(()=>Math.random()-0.5);
  renderGrid(__lastTemplates, { category: catSel.value, style: styleSel.value });
  setStatus("New layout (shuffled)");
});

newStyleBtn && newStyleBtn.addEventListener("click", ()=>{
  // cycle the style dropdown if present
  const opts = Array.from(styleSel.options);
  const ix = Math.max(0, opts.findIndex(o=>o.selected));
  const next = opts[(ix+1) % opts.length];
  next.selected = true;
  setStatus(`Style: ${styleSel.value}`);
});

exportBtn && exportBtn.addEventListener("click", ()=>{
  const blob = new Blob([JSON.stringify(__lastTemplates, null, 2)], { type:"application/json" });
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = "templify_templates.json";
  a.click();
  URL.revokeObjectURL(a.href);
  setStatus("Exported JSON");
});

// nav buttons (safe)
btnTemplates && btnTemplates.addEventListener("click", ()=>{ window.scrollTo({ top: 0, behavior: "smooth" }); });
btnAnimate && btnAnimate.addEventListener("click", ()=>{ alert("Animate Studio is coming later (separate module)."); });

// init theme + initial seeds
(function init(){
  const saved = localStorage.getItem("templify_theme");
  setTheme(saved || "dark");

  const category = catSel?.value || "Instagram Post";
  const style = styleSel?.value || "Dark Premium";
  const count = clamp(safeInt(countInp?.value, 24), 1, 200);

  // if last templates exist, show them; otherwise seeds
  try{
    const last = JSON.parse(localStorage.getItem("templify_last_templates")||"null");
    if(Array.isArray(last) && last.length){
      renderGrid(last, { category, style });
      setStatus(`Loaded ${last.length} templates`);
      return;
    }
  }catch(e){}
  renderGrid(makeSeedTemplates({ count, category, style }), { category, style });
  setStatus("Ready");
})();

</script>


</body>
</html>
