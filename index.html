<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Templify â€“ Dark Premium AI Template Generator</title>

  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --primary:#0b5fff;
      --muted:#aab0bd;

      /* DARK (transparent) */
      --bg:#050712;
      --panel:rgba(15,18,32,.55);
      --panel2:rgba(15,18,32,.35);
      --stroke:rgba(255,255,255,.10);
      --text:#f6f7fb;

      --shadow:0 18px 50px rgba(0,0,0,.45);
      --radius:18px;
    }
    [data-theme="light"]{
      --bg:#f5f7ff;
      --panel:rgba(255,255,255,.72);
      --panel2:rgba(255,255,255,.55);
      --stroke:rgba(10,20,60,.12);
      --text:#0b1020;
      --shadow:0 18px 40px rgba(10,20,60,.18);
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:Poppins,system-ui,-apple-system,Segoe UI,Roboto,Arial;
      color:var(--text);
      background:
        radial-gradient(1200px 700px at 15% 10%, rgba(11,95,255,.22), transparent 60%),
        radial-gradient(900px 600px at 85% 20%, rgba(136,71,255,.18), transparent 55%),
        radial-gradient(900px 600px at 35% 95%, rgba(0,225,255,.10), transparent 55%),
        var(--bg);
      overflow-x:hidden;
    }

    .wrap{max-width:1200px;margin:0 auto;padding:26px 18px 60px}
    header{
      display:flex;align-items:center;justify-content:space-between;gap:12px;
      padding:14px 16px;border:1px solid var(--stroke);
      background:var(--panel);
      backdrop-filter: blur(16px);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      position:sticky;top:14px;z-index:20;
    }
    .brand{display:flex;align-items:center;gap:12px}
    .logo{
      width:38px;height:38px;border-radius:12px;
      background:linear-gradient(135deg, rgba(11,95,255,.95), rgba(136,71,255,.88));
      box-shadow:0 10px 26px rgba(11,95,255,.28);
      border:1px solid rgba(255,255,255,.18);
    }
    .brand h1{font-size:15px;margin:0;font-weight:700;letter-spacing:.2px}
    .brand p{margin:0;color:var(--muted);font-size:12px}
    .actions{display:flex;align-items:center;gap:10px;flex-wrap:wrap}
    .btn{
      appearance:none;border:1px solid var(--stroke);
      background:var(--panel2);
      color:var(--text);
      padding:10px 12px;border-radius:14px;
      font-weight:600;font-size:12.5px;
      cursor:pointer;transition:.15s ease;
      backdrop-filter: blur(16px);
      display:inline-flex;align-items:center;gap:8px;
    }
    .btn:hover{transform:translateY(-1px);border-color:rgba(11,95,255,.35)}
    .btn.primary{
      background:linear-gradient(135deg, rgba(11,95,255,.95), rgba(136,71,255,.85));
      border-color:rgba(255,255,255,.14);
      box-shadow:0 12px 30px rgba(11,95,255,.22);
    }
    .btn:active{transform:translateY(0px)}
    .tag{
      padding:6px 10px;border:1px solid var(--stroke);
      background:var(--panel2);
      border-radius:999px;font-size:12px;color:var(--muted)
    }

    main{margin-top:18px;display:grid;grid-template-columns:1.1fr .9fr;gap:18px}
    .card{
      border:1px solid var(--stroke);
      background:var(--panel);
      backdrop-filter: blur(16px);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      overflow:hidden;
    }
    .hero{padding:26px}
    .hero h2{margin:0 0 10px;font-size:34px;line-height:1.12}
    .hero p{margin:0 0 16px;color:var(--muted);font-size:14px;line-height:1.55}
    .grid{
      display:grid;grid-template-columns:repeat(3,minmax(0,1fr));
      gap:12px;margin-top:18px
    }
    .tile{
      padding:14px;border:1px solid var(--stroke);
      background:var(--panel2);
      border-radius:16px;
      min-height:92px;
      position:relative;
      overflow:hidden;
    }
    .thumb{
      height:84px;
      border-radius:12px;
      margin-bottom:10px;
      position:relative;
      background:
        radial-gradient(160px 80px at 20% 20%, rgba(11,95,255,.24), transparent 60%),
        radial-gradient(140px 90px at 90% 35%, rgba(136,71,255,.18), transparent 60%),
        linear-gradient(135deg, rgba(255,255,255,.12), rgba(255,255,255,.04));
      border:1px solid rgba(255,255,255,.14);
    }
    [data-theme="light"] .thumb{
      background:
        radial-gradient(160px 80px at 20% 20%, rgba(11,95,255,.14), transparent 60%),
        radial-gradient(140px 90px at 90% 35%, rgba(136,71,255,.10), transparent 60%),
        linear-gradient(135deg, rgba(10,20,60,.06), rgba(10,20,60,.02));
      border:1px solid rgba(10,20,60,.12);
    }
    .mini{
      position:absolute;
      border-radius:10px;
      border:1px solid rgba(255,255,255,.16);
      background:rgba(255,255,255,.10);
    }
    [data-theme="light"] .mini{
      border:1px solid rgba(10,20,60,.12);
      background:rgba(10,20,60,.06);
    }
    .tile b{display:block;font-size:12.5px;margin-bottom:6px}
    .tile span{font-size:12px;color:var(--muted);line-height:1.35}
    .right{padding:18px}
    .right h3{margin:2px 0 10px;font-size:14px}
    .field{margin:10px 0}
    .field label{display:block;font-size:12px;color:var(--muted);margin:0 0 6px}
    .field input,.field select,.field textarea{
      width:100%;padding:11px 12px;border-radius:14px;
      border:1px solid var(--stroke);
      background:rgba(0,0,0,.10);
      color:var(--text);
      outline:none;
    }
    [data-theme="light"] .field input,
    [data-theme="light"] .field select,
    [data-theme="light"] .field textarea{
      background:rgba(255,255,255,.50);
    }
    textarea{min-height:96px;resize:vertical}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    .foot{
      display:flex;align-items:center;justify-content:space-between;gap:10px;
      padding:14px 18px;border-top:1px solid var(--stroke);
      color:var(--muted);font-size:12px
    }

    @media (max-width: 980px){
      main{grid-template-columns:1fr}
      .hero h2{font-size:28px}
      .grid{grid-template-columns:repeat(2,minmax(0,1fr))}
    }
    @media (max-width: 520px){
      header{position:relative;top:auto}
      .grid{grid-template-columns:1fr}
      .row{grid-template-columns:1fr}
    }
  
    /* FIX: dropdown options visibility + borders */
    
    select{
      border:1px solid rgba(10,20,60,.45);
      background:#ffffff;
      color:#0b1020;
    }
    select option{
      color:#0b1020;
      background:#ffffff;
    }
    [data-theme="dark"] select{
      border:1px solid rgba(255,255,255,.25);
      background:#0b1020;
      color:#ffffff;
    }
    [data-theme="dark"] select option{
      color:#ffffff;
      background:#0b1020;
    }
    
    [data-theme="dark"] select option{color:#ffffff;background:#0b1020;}
    
/* === Nexora Canva-style previews === */
.tile .preview-canvas{
  position: relative;
  height: 120px;
  border-radius: 14px;
  overflow: hidden;
  background: rgba(255,255,255,.06);
  border: 1px solid var(--stroke);
  margin-bottom: 10px;
}
.tile .preview-canvas .pv-text{
  position:absolute;
  left:12px;
  right:12px;
  font-weight:700;
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
}

</style>
    
</head>

<body data-theme="dark">
  <div class="wrap">
    <header>
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <div>
          <h1>Templify</h1>
          <p>Dark Premium AI Template Generator + Ultimate Editor v1</p>
        </div>
      </div>

      <div class="actions">
        <span class="tag">No auth â€¢ No subscriptions â€¢ Netlify-ready</span>
        <button class="btn" id="themeBtn" type="button">ðŸŒ— Toggle theme</button>
        <button class="btn primary" id="openEditor" type="button">Open Editor</button>
        <button class="btn" id="btnTemplates" type="button">ðŸ“š Library</button>
        <button class="btn" id="btnAnimate" type="button">ðŸŽ¬ Animate</button>

      </div>
    </header>

    <main>
      <section class="card hero">
        <h2>Create hundreds of premium templates in minutes.</h2>
        <p>
          Generate designs fast, then fineâ€‘tune in the editor with a Canvaâ€‘style workflow:
          layers, properties, snap grid, multiâ€‘select, duplicate, undo/redo, and autosave.
        </p>

        <div class="actions" style="margin-top:14px">
          <button class="btn primary" id="generateBtn" type="button">âš¡ Generate Templates</button>
        <button class="btn" id="newLayoutBtn" type="button">ðŸ§© New Layout</button>
        <button class="btn" id="newStyleBtn" type="button">ðŸŽ¨ New Style</button>

          <button class="btn" id="exportBtn" type="button">â¬‡ Export List (JSON)</button>
        </div>

        <div class="grid" id="previewGrid" aria-live="polite" style="margin-top:18px"></div>
      </section>

      <aside class="card right">
        <h3>Generation settings</h3>

        <div class="field">
          <label>Category</label>
          <select id="cat">
            <option>Instagram Post</option>
            <option>YouTube Thumbnail</option>
            <option>Flyer</option>
            <option>Business Card</option>
            <option>Logo</option>
            <option>Presentation Slide</option>
            <option>Resume</option>
            <option>Poster</option>
            <option>Story</option>
          </select>
        </div>

        <div class="row">
          <div class="field">
            <label>Count (max 200)</label>
            <input id="count" type="number" min="1" max="200" value="24" />
          </div>
          <div class="field">
            <label>Style</label>
            <select id="style">
              <option>Dark Premium</option>
              <option>Light Minimal</option>
              <option>Neon</option>
              <option>Glassmorphism</option>
              <option>Corporate</option>
            </select>
          </div>
        </div>

        <div class="field">
          <label>Prompt</label>
          <textarea id="prompt" placeholder="e.g., Premium real-estate carousel for luxury apartments, bold typography, modern shapes..."></textarea>
        </div>

        <div class="field">
          <label>Notes</label>
          <input id="notes" placeholder="(optional) brand name, colors, etc." />
        </div>

        <div class="foot">
          <span>Tip: Click any preview to open it in the Editor.</span>
          <span id="status">Ready</span>
        </div>
      </aside>
    </main>
  </div>

<script src="design.js"></script>
<script>
(function(){
  const $ = (sel)=>document.querySelector(sel);

  const themeBtn = $("#themeBtn");
  const openEditorBtn = $("#openEditor");
  const btnTemplates = $("#btnTemplates");
  const btnAnimate = $("#btnAnimate");

  const grid = $("#previewGrid");
  const genBtn = $("#generateBtn");
  const newLayoutBtn = $("#newLayoutBtn");
  const newStyleBtn = $("#newStyleBtn");
  const exportBtn = $("#exportBtn");
  const categorySel = $("#cat");
  const countInput = $("#count");
  const styleSel = $("#style");
  const promptInput = $("#prompt");
  const notesInput = $("#notes");
  const statusEl = $("#status");

  const LS_KEY = "nexora_last_settings_v1";

  function readSettings(){
    return {
      category: categorySel?.value || "Instagram Post",
      count: Math.max(1, Math.min(200, parseInt(countInput?.value||"24",10) || 24)),
      style: styleSel?.value || "Dark Premium",
      prompt: promptInput?.value || "",
      notes: notesInput?.value || ""
    };
  }

  function saveSettings(){
    try{ localStorage.setItem(LS_KEY, JSON.stringify(readSettings())); }catch(e){}
  }

  function loadSettings(){
    try{
      const raw = localStorage.getItem(LS_KEY);
      if(!raw) return;
      const s = JSON.parse(raw);
      if(categorySel && s.category) categorySel.value = s.category;
      if(countInput && s.count) countInput.value = String(s.count);
      if(styleSel && s.style) styleSel.value = s.style;
      if(promptInput && typeof s.prompt==="string") promptInput.value = s.prompt;
      if(notesInput && typeof s.notes==="string") notesInput.value = s.notes;
    }catch(e){}
  }

  function setStatus(text){
    if(statusEl) statusEl.textContent = text || "";
  }

  function escapeHtml(s){
    return String(s||"")
      .replaceAll("&","&amp;")
      .replaceAll("<","&lt;")
      .replaceAll(">","&gt;")
      .replaceAll('"',"&quot;")
      .replaceAll("'","&#039;");
  }

  function clearGrid(){ if(grid) grid.innerHTML=""; }

  function cardTemplate(t){
    const el=document.createElement("div");
    el.className="card";
    el.innerHTML = `
      <div class="thumb"></div>
      <div class="meta">
        <div class="t1">${escapeHtml(t.title||"")}</div>
        <div class="t2">${escapeHtml(t.subtitle||"")}</div>
        <div class="t3">${escapeHtml(t.category||"")} â€¢ Click to edit</div>
      </div>
    `;
    const thumb = el.querySelector(".thumb");
    if(window.NexoraDesign && thumb){
      window.NexoraDesign.renderPreview(t, thumb);
    } else if(thumb){
      thumb.style.height="160px";
      thumb.style.background="linear-gradient(135deg, rgba(47,123,255,0.35), rgba(155,92,255,0.15))";
      thumb.style.borderRadius="14px";
    }

    el.addEventListener("click", ()=>{
      try{ localStorage.setItem("nexora_selected_template_v1", JSON.stringify(t)); }catch(e){}
      window.location.href="editor.html";
    });
    return el;
  }

  function renderTemplates(templates){
    clearGrid();
    const list = Array.isArray(templates) ? templates : [];
    for(const t of list) grid.appendChild(cardTemplate(t));
    try{ localStorage.setItem("nexora_last_generated_v1", JSON.stringify({ templates: list })); }catch(e){}
    setStatus(`Loaded ${list.length} templates`);
  }

  function seedTemplates(){
    const s=readSettings();
    const count=Math.min(12, s.count||12);
    if(window.NexoraDesign){
      const templates=window.NexoraDesign.generateTemplates({ ...s, count });
      renderTemplates(templates);
    }else{
      const templates=Array.from({length:count}).map((_,i)=>({
        id:"seed_"+i,
        title:`${s.category} #${i+1}`,
        subtitle:`${s.style} â€¢ Ready`,
        category:s.category,
        style:s.style,
        canvas:{w:1080,h:1080},
        elements:[{type:"bg",x:0,y:0,w:1080,h:1080,fill:"#0b1020",fill2:"#0a2a5a",style:"radial"}]
      }));
      renderTemplates(templates);
    }
  }

  async function generateFromAPI(){
    const s=readSettings();
    setStatus("Generatingâ€¦");
    saveSettings();
    seedTemplates(); // immediate visible change

    try{
      const resp = await fetch("/api/generate", {
        method:"POST",
        headers:{ "Content-Type":"application/json" },
        body: JSON.stringify({ prompt:s.prompt, category:s.category, style:s.style, count:s.count, notes:s.notes })
      });
      const data = await resp.json().catch(()=>null);
      if(!resp.ok || !data || !data.success) throw new Error(data?.error || `Request failed (${resp.status})`);
      const templates = Array.isArray(data.templates) ? data.templates : [];
      renderTemplates(templates);
      setStatus(`Generated ${templates.length} templates`);
    }catch(e){
      console.warn(e);
      setStatus("Generated (fallback)");
    }
  }

  function bind(){
    // topbar buttons
    try{
      const saved = localStorage.getItem("nexora_theme");
      if(saved==="light"||saved==="dark") document.body.setAttribute("data-theme", saved);
    }catch(e){}
    if(themeBtn) themeBtn.addEventListener("click", ()=>{
      const cur = document.body.getAttribute("data-theme") || "dark";
      const next = cur === "dark" ? "light" : "dark";
      document.body.setAttribute("data-theme", next);
      try{ localStorage.setItem("nexora_theme", next); }catch(e){}
    });
    if(openEditorBtn) openEditorBtn.addEventListener("click", ()=>{
      window.location.href = "editor.html";
    });
    // (Library / Animate are placeholders for now)
    if(btnTemplates) btnTemplates.addEventListener("click", ()=>{ setStatus("Library coming soon"); });
    if(btnAnimate) btnAnimate.addEventListener("click", ()=>{ setStatus("Animate Studio coming soon"); });

    if(genBtn) genBtn.addEventListener("click", generateFromAPI);
    if(newLayoutBtn) newLayoutBtn.addEventListener("click", ()=>{
      if(promptInput) promptInput.value = (promptInput.value||"").trim() + " ";
      generateFromAPI();
    });
    if(newStyleBtn) newStyleBtn.addEventListener("click", ()=>{
      if(styleSel){
        const opts=[...styleSel.options].map(o=>o.value);
        const i=Math.max(0, opts.indexOf(styleSel.value));
        styleSel.value = opts[(i+1)%opts.length] || styleSel.value;
      }
      generateFromAPI();
    });
    if(exportBtn) exportBtn.addEventListener("click", ()=>{
      try{
        const raw = localStorage.getItem("nexora_last_generated_v1");
        const payload = raw ? JSON.parse(raw) : { templates: [] };
        const blob = new Blob([JSON.stringify(payload, null, 2)], {type:"application/json"});
        const a=document.createElement("a");
        a.href=URL.createObjectURL(blob);
        a.download="nexora-templates.json";
        a.click();
        setTimeout(()=>URL.revokeObjectURL(a.href), 800);
      }catch(e){
        alert("Nothing to export yet.");
      }
    });

    for(const el of [categorySel, countInput, styleSel, promptInput, notesInput]){
      if(!el) continue;
      el.addEventListener("change", ()=>{ saveSettings(); seedTemplates(); });
      el.addEventListener("input", ()=>{ saveSettings(); });
    }
  }

  function boot(){
    loadSettings();
    bind();
    seedTemplates(); // boxes visible immediately
    setStatus("Ready");
  }

  document.addEventListener("DOMContentLoaded", boot);
})();</script>


</body>
</html>
